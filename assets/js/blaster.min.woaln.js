function ensureModalExists(){if(!document.getElementById("blast-js-modal")){document.body.insertAdjacentHTML("beforeend",modalHtml);let e=document.createElement("style");e.textContent=`
            @media (min-width: 768px) {
                #blast-js-modal > div {
                    margin: 5% auto !important;
                    width: 80% !important;
                    height: auto !important;
                    max-width: 900px !important;
                    border-radius: 4px !important;
                }
            }
        `,document.head.appendChild(e),document.getElementById("blast-js-modal-close").onclick=function(){document.getElementById("blast-js-modal").style.display="none"},document.getElementById("blast-js-modal").onclick=function(e){e.target===this&&(this.style.display="none")}}}function showModal(e,t){ensureModalExists();let n=document.getElementById("blast-js-modal"),l=document.getElementById("blast-js-modal-title"),i=document.getElementById("blast-modal-content");n&&l&&i&&(l.innerHTML=e,i.innerHTML=t,n.style.display="block")}require=function e(t,n,l){function i(a,s){if(!n[a]){if(!t[a]){var o="function"==typeof require&&require;if(!s&&o)return o(a,!0);if(r)return r(a,!0);var p=Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){return i(t[a][1][e]||e)},d,d.exports,e,t,n,l)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<l.length;a++)i(l[a]);return i}({1:[function(e,t,n){(function(e){function n(e,t,n){for(;t&&t!==Object.prototype&&(Object.getOwnPropertyNames(t).forEach(function(n){if(".class"!=n&&!e.hasOwnProperty(n)){var l=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,l)}}),!n);)t=t.__proto__;return e}var l=function(e,t,n){"function"!=typeof e&&(n=t,t=e,e=Object),t=t||{};var i={name:(n=n||{}).name,base:e,implements:[]},r=l.clone(t);function a(){"function"==typeof this.constructor&&this.constructor.apply(this,arguments)}return n.implements&&(Array.isArray(n.implements)?n.implements:[n.implements]).forEach(function(e){"function"==typeof e&&e.prototype&&(i.implements.push(e),l.extend(r,e.prototype))}),r.__proto__=e.prototype,(i.type=a).prototype=r,Object.defineProperty(a,".class.meta",{value:i,enumerable:!1,configurable:!1,writable:!1}),Object.defineProperty(r,".class",{value:a,enumerable:!1,configurable:!1,writable:!1}),n.statics&&l.extend(a,n.statics),a};l.extend=n,l.clone=function(e){return n({},e)};var i=l({constructor:function(e){this.object=e},typeOf:function(e){if(this.object instanceof e)return!0;var t=l.typeInfo(this.object);return t&&function e(t,n){for(;t;){if(t.type.prototype===n.prototype)return!0;for(var l in t.implements){var i=t.implements[l],r=i[".class.meta"];if(r){if(e(r,n))return!0}else for(var a=i.prototype;a;a=a.__proto__)if(a===n.prototype)return!0}t=t.base?t.base[".class.meta"]:void 0}return!1}(t,e)}});i.prototype.a=i.prototype.typeOf,i.prototype.an=i.prototype.typeOf,l.is=function(e){return new i(e)},l.typeInfo=function(e){var t=e.__proto__[".class"];return t?t[".class.meta"]:void 0},l.VERSION=[0,0,2],t?t.exports=l:e.Class=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{},],2:[function(e,t,n){(function(){var e=Array.prototype.slice,t=Array.prototype.forEach,n=function(l){if("object"!=typeof l)throw l+" is not an object";var i=e.call(arguments,1);return t.call(i,function(e){if(e)for(var t in e)"object"==typeof e[t]&&l[t]?n.call(l,l[t],e[t]):l[t]=e[t]}),l};this.extend=n}).call(this)},{},],"biojs-vis-blasterjs":[function(e,t,n){var l=e("js-class");t.exports=l({constructor:function(t){var n=this;e("js-extend").extend(this.opt,t);var l="table tbody tr td button:hover{ text-decoration: underline;}",i=document.createElement("style");if(i.styleSheet?i.styleSheet.cssText=l:i.appendChild(document.createTextNode(l)),document.getElementsByTagName("head")[0].appendChild(i),n.opt.string){var r={target:{files:[new Blob([n.opt.string],{type:"text/plain"})]}};n._displayAlignments(r,n)}else document.getElementById(n.opt.input).addEventListener("change",function(e){n._displayAlignments(e,n)},!1)},opt:{input:"blastinput",multipleAlignments:"blast-multiple-alignments",alignmentsTable:"blast-alignments-table",singleAlignment:"blast-single-alignment"},_displayAlignments:function(e,t){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var n=e.target.files[0];if(n){var l=new FileReader;l.onload=function(e){try{var n,l=(n=e.target.result).split("\n")[2].startsWith("<BlastOutput>")?function(e){for(var t=[],n=e.split("\n"),l=0,i=0;i<n.length;i++)n[i].startsWith("<Iteration>")&&l++;if(1==l)t.push(e);else{var r=0,a="";for(i=0;i<n.length&&!n[r=i].startsWith("<Iteration>");i++)a=a+n[i]+"\n";for(var s=0;s<l;s++){var o=a+n[r]+"\n";for(r++;void 0!==n[r]&&!n[r].startsWith("<Iteration>");)o=o+n[r]+"\n",r++;t.push(o)}}return t}(n):function(e){for(var t=[],n=e.split("\n"),l=0,i=0;i<n.length;i++)n[i].startsWith("Query=")&&l++;if(1==l)t.push(e);else{var r=0,a="";for(i=0;i<n.length&&!n[r=i].startsWith("Query=");i++)a=a+n[i]+"\n";for(var s=0;s<l;s++){var o=a+n[r]+"\n";for(r++;void 0!==n[r]&&!n[r].startsWith("Query=");)o=o+n[r]+"\n",r++;o+="\nend\n",t.push(o)}}return t}(n),i=s(l[0]),r=a(l[0]);if(0==i.length)v(l,[],0,r,!0,!0,t);else{var o=i[0].hsp.length;b(l,o,0,i,r,!0,!0,t),x(i,t)}}catch(p){for(var d=["blast-multiple-alignments","blast-alignments-table"],c=0;c<d.length;c++)for(var h=document.getElementById(d[c]);h.firstChild;)h.removeChild(h.firstChild);alert("ERROR WHILE UPLOADING DATA: You have uploaded an invalid BLAST output file.")}},l.readAsText(n)}else alert("ERROR WHILE UPLOADING DATA: Failed to load file.")}else alert("The File APIs are not fully supported by your browser.");function i(e,t,n,l,i){this.description=e,this.length=t,this.totalScore=n,this.queryCover=l,this.hsp=i}function r(e,t,n,l,i,r,a,s,o,p,d,c){this.score=e,this.eValue=t,this.identities=n,this.positives=l,this.gaps=i,this.queryStart=r,this.query=a,this.queryEnd=s,this.comparison=o,this.subjectStart=p,this.subject=d,this.subjectEnd=c}function a(e){return e.split("\n")[2].startsWith("<BlastOutput>")?function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)if(t[n].includes("<Iteration_query-len>")){n=t[n].split(">")[1].split("</")[0];break}return n}(e):function(e){for(var t=e.split("\n"),n=0,l=0;l<t.length;l++)if(t[l].startsWith("Length=")){n=t[l].split("=")[1];break}return n}(e)}function s(e){return e.split("\n")[2].startsWith("<BlastOutput>")?function(e){for(var t=e.split("\n"),n=[],l=0;l<t.length;l++)if(t[l].startsWith("<Hit>")){for(var s="",p=l;p<t.length&&(s+=t[p],!t[p].includes("</Hit>"));p++);for(var d=s.split("<Hit_id>")[1].split("</")[0],c=s.split("<Hit_def>")[1].split("</")[0],h=d.concat(" ").concat(c),m=s.split("<Hit_len>")[1].split("</")[0],u=[],y=s.split("<Hit_hsps>")[1].split("</Hit_hsps>")[0].split("</Hsp>"),g=0;g<y.length-1;g++){var f=y[g].split("<Hsp_bit-score>")[1].split("</")[0],$=y[g].split("<Hsp_evalue>")[1].split("</")[0],v=y[g].split("<Hsp_identity>")[1].split("</")[0],b=y[g].split("<Hsp_align-len>")[1].split("</")[0],x=v/b*100;if(t[3].includes("<BlastOutput_program>blastn</BlastOutput_program>"))var E="N/A",C=y[g].split("<Hsp_gaps>")[1].split("</")[0]/b*100;else E=parseFloat(y[g].split("<Hsp_positive>")[1].split("</")[0]/b*100).toFixed(0),C=y[g].split("<Hsp_gaps>")[1].split("</")[0]/b*100;var _=y[g].split("<Hsp_query-from>")[1].split("</")[0],w=y[g].split("<Hsp_qseq>")[1].split("</")[0],T=y[g].split("<Hsp_query-to>")[1].split("</")[0],H=y[g].split("<Hsp_midline>")[1].split("</")[0],L=y[g].split("<Hsp_hit-from>")[1].split("</")[0],F=y[g].split("<Hsp_hseq>")[1].split("</")[0],A=y[g].split("<Hsp_hit-to>")[1].split("</")[0],M=new r(f,$,parseFloat(x).toFixed(0),E,parseFloat(C).toFixed(0),_,w,T,H,L,F,A);u.push(M)}for(var B=parseFloat(u[0].score),k=1;k<u.length;k++)B+=parseFloat(u[k].score);var W=new i(h,m,B.toFixed(1),o(u,a(e)),u);n.push(W)}return n}(e):function(e){for(var t=e.split("\n"),n=[],l=0;l<t.length;l++)if(t[l].startsWith(">")){for(var s=t[l].split(">")[1],p="",d=l;""==p;)t[d+=1].startsWith("Length=")?p=t[d]:s+=t[d];var c=s,h=p.split("=")[1],m=[],u=!1;do{if(u&&(d-=1),t[d+2].startsWith(" Features in this part of subject sequence:"))for(d+=3;!t[d+2].startsWith(" Score =");)d++;var y=t[d+2].split(",")[0].replace(/\s\s+/g," ").split(" ")[3],g=t[d+2].split(",")[1].split(" ")[4],f=t[d+3].split(",")[0].split("(")[1].substr(0,t[d+3].split(",")[0].split("(")[1].length-2);if(t[0].startsWith("BLASTN"))var $="N/A",v=t[d+3].split(",")[1].split("(")[1].substr(0,t[d+3].split(",")[1].split("(")[1].length-2);else $=t[d+3].split(",")[1].split("(")[1].substr(0,t[d+3].split(",")[1].split("(")[1].length-2),v=t[d+3].split(",")[2].split("(")[1].substr(0,t[d+3].split(",")[2].split("(")[1].length-2);("Frame"==t[d+4].split(",")[0].split(" ")[1]||t[d+4].startsWith(" Strand"))&&(d+=1);var b=t[d+5].substring(5).replace(/^\s+/g,"").split(" ")[0],x=t[d+5].substring(5).replace(/\s+/g,"").replace(/[0-9]/g,""),E=t[d+5].substring(5).replace(/^\s+/g,"").split(" ")[t[d+5].substring(5).replace(/^\s+/g,"").split(" ").length-1],C=t[d+6].replace(/^\s+/g,""),_=t[d+7].substring(5).replace(/^\s+/g,"").split(" ")[0],w=t[d+7].substring(5).replace(/\s+/g,"").replace(/[0-9]/g,""),T=t[d+7].substring(5).replace(/^\s+/g,"").split(" ")[t[d+7].substring(5).replace(/^\s+/g,"").split(" ").length-1];for(d+=9;t[d].startsWith("Query");){var H=t[d].substring(5).replace(/\s+/g,"").replace(/[0-9]/g,"");x+=H,E=t[d].substring(5).replace(/^\s+/g,"").split(" ")[t[d].substring(5).replace(/^\s+/g,"").split(" ").length-1],w+=t[d+2].substring(5).replace(/\s+/g,"").replace(/[0-9]/g,""),T=t[d+2].substring(5).replace(/^\s+/g,"").split(" ")[t[d+2].substring(5).replace(/^\s+/g,"").split(" ").length-1];var L=t[d+1].replace(/^\s+/g,"");if(H.length>L.length)for(var F=H.length-L.length,A=0;A<F;A++)L=" "+L;C+=L,d+=4}var M=new r(y,g,f,$,v,b,x,E,C,_,w,T);m.push(M),u=!0}while(t[d+1].startsWith(" Score"));for(var B=parseFloat(m[0].score),k=1;k<m.length;k++)B+=parseFloat(m[k].score);var W=new i(c,h,B.toFixed(1),o(m,a(e)),m);n.push(W)}return n}(e)}function o(e,t){for(var n=0,l=p(e),i=0;i<l.length;i++)n+=parseInt(100*(l[i].end-l[i].start+1)/t);return n}function p(e){for(var t=[],n=0;n<e.length;n++)parseInt(e[n].queryStart)>parseInt(e[n].queryEnd)?t.push({start:parseInt(e[n].queryEnd),end:parseInt(e[n].queryStart)}):t.push({start:parseInt(e[n].queryStart),end:parseInt(e[n].queryEnd)});return function(e){for(var t=[],n=0;n<e.length;n++){for(var l=e[n][0].start,i=e[n][0].end,r=0;r<e[n].length;r++)e[n][r].start<l&&(l=e[n][r].start),e[n][r].end>i&&(i=e[n][r].end);t.push({start:l,end:i})}return t}(function(e){e.sort(function(e,t){return e.start<t.start?-1:e.start>t.start?1:0});var t,n=[],l=0;n[l]=[e[0]];for(var i=1,r=e.length;i<r;i++)e[i].start>=e[i-1].start&&e[i].start<(0!=(t=n[l]).length&&(t.sort(function(e,t){return e.end<t.end?1:e.end>t.end?-1:0}),t[0].end))?n[l].push(e[i]):n[++l]=[e[i]];return n}(t))}function d(e,t){if(e)switch(t){case 1:return"<40";case 2:return"40-50";case 3:return"50-80";case 4:return"80-200";case 5:return">=200";default:return"0"}else switch(t){case 1:return">100";case 2:return"100-1";case 3:return"1-1e<sup>-2</sup>";case 4:return"1e<sup>-2</sup>-1e<sup>-5</sup>";case 5:return"<1e<sup>-5</sup>";default:return"0"}}function c(e,t){if(e)switch(t){case 1:return"#5C6D7E";case 2:return"#9B59B6";case 3:return"#5CACE2";case 4:return"#57D68D";case 5:return"#C0392B";default:return"#FFF"}else switch(t){case 1:return"#BCBCBC";case 2:return"#989898";case 3:return"#747474";case 4:return"#565656";case 5:return"#343434";default:return"#FFF"}}function h(e){var t,n=document.getElementById(e).parentElement.parentElement,l=document.getElementsByClassName("alignment-table-description");for(t=0;t<l.length;t++)l[t].style.fontWeight="normal",l[t].parentElement.parentElement.style.fontWeight="normal";n.style.fontWeight="bold",document.getElementById(e).style.fontWeight="bold"}function m(e,t,n,l){for(var i=0;i<t;i++)if(0==i){var r=l/2,a=document.createElement("div"),s=document.createElement("div");a.style.float="left",a.style.width=r+"px",a.style.textAlign="left",a.innerHTML="0",s.style.float="left",s.style.width=r+"px",s.style.textAlign="right",s.innerHTML=n*(i+1),e.appendChild(a),e.appendChild(s)}else{var o=document.createElement("div");o.style.float="left",o.style.width=l+"px",o.style.textAlign="right",o.innerHTML=n*(i+1),e.appendChild(o)}return e}function u(e,t,n,l){var i,r,a,s,o,p,h,u,y,g,f=document.createElement("div"),$=function(e,t){var n=document.createElement("div"),l=document.createElement("div"),i=document.createElement("div");n.style.color="#EEE",l.style.minWidth="50px",l.style.minHeight="10px",l.style.float="left",n.appendChild(l);for(var r=1;r<=5;r++){var a=document.createElement("div");a.style.minWidth="100px",a.style.textAlign="center",a.style.float="left",a.innerHTML=d(t,r).bold(),a.style.backgroundColor=c(e,r),n.appendChild(a)}return i.style.clear="both",n.appendChild(i),n}(t,n),v=(i=t,r=document.createElement("div"),a=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),r.style.marginTop="3px",r.style.color="#5C6D7E",r.style.fontSize="10px",a.style.width="50px",a.innerHTML="QUERY".bold(),a.style.float="left",s.style.width="500px",s.style.height="10px",s.style.float="left",s.style.marginTop="2px",o.style.clear="both",s.style.backgroundColor=i?"#C0392B":"#343434",r.appendChild(a),r.appendChild(s),r.appendChild(o),r),b=(p=l,h=document.createElement("div"),u=document.createElement("div"),y=document.createElement("div"),g=document.createElement("div"),h.style.marginBottom="5px",h.style.fontSize="11px",u.style.minWidth="50px",u.style.minHeight="10px",u.style.float="left",y.style.float="left",g.style.clear="both",y=function(e,t){var n=document.createElement("div");if(4<t){if(t%5==0)e=m(e,5,t/5,100);else{var l=500/(5+t%5/5);e=m(e,5,parseInt(t/5),parseInt(l));var i=parseInt(500-5*l),r=document.createElement("div");r.style.float="left",r.style.width=i+"px",r.style.textAlign="right",r.innerHTML=t,e.appendChild(r)}}else e=m(e,t,1,parseInt(500/t));return n.style.clear="both",e.appendChild(n),e}(y,p),h.appendChild(u),h.appendChild(y),h.appendChild(g),h);return f.style.color="#5C6D7E",f.style.textAlign="center",f.style.paddingBottom="5px",f.innerHTML="Color key for Alignment Scores".bold(),e.appendChild(f),e.appendChild($),e.appendChild(v),e.appendChild(b),e}function y(e,t,n){var l=p(t.hsp),i=document.createElement("div"),r=document.createElement("div");i.style.minHeight="12px";for(var a=0;a<l.length;a++){var s=document.createElement("div"),o=document.createElement("div"),d=document.createElement("a");if(0==a){if(1==l[0].start)var c=parseInt(50+500*(l[0].start-1)/n);else c=parseInt(50+500*l[0].start/n);var m=parseInt(550-c-500*(n-l[0].end)/n)}else c=parseInt(500*(l[a].start-l[a-1].end)/n),m=parseInt(500*(l[a].end-l[a].start)/n);s.style.width=c+"px",s.style.minHeight="4px",s.style.float="left",o.style.width=m+"px",o.style.minHeight="12px",o.style.float="left",o.style.backgroundColor=e,o.onmouseout=function(){document.getElementById("defline").value=" Mouse over to show defline and scores, click to highlight row"},o.onmouseover=function(){document.getElementById("defline").value=" "+t.description+". S="+t.hsp[0].score+" E="+t.hsp[0].eValue},d.href="#"+t.description.split(" ")[0],d.onclick=function(){h(t.description.split(" ")[0])},d.appendChild(o),i.appendChild(s),i.appendChild(d)}return r.style.clear="both",i.appendChild(r),i}function g(e){var t=document.createElement("button");t.id="downloadAlignments"+e,t.className="btn",t.style.marginRight="10px",t.style.marginTop="5px";var n=document.createTextNode("Download as "+e);return t.appendChild(n),t.addEventListener("click",function(){var t,n,l,i;t=e,n=document.getElementById("blast-multiple-alignments-buttons"),l=document.getElementById("defline"),(i=document.getElementById("alignments-container")).removeChild(n),i.removeChild(l),html2canvas(i,{onrendered:function(e){document.body.appendChild(e);var r=document.createElement("a");document.body.appendChild(r),r.href="JPEG"==t?e.toDataURL("image/jpeg"):e.toDataURL("img/png"),r.download="alignments."+t.toLowerCase(),r.click(),document.body.removeChild(e),document.body.removeChild(r),i.appendChild(l),i.appendChild(n),r=document.createElement("a"),document.body.appendChild(r),r.href="#blast-multiple-alignments",r.click(),document.body.removeChild(r)}})},!1),t}function f(e){return e.split("\n")[2].startsWith("<BlastOutput>")?function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)if(t[n].includes("<Iteration_query-def>"))return t[n].split(">")[1].split("</")[0]}(e):function(e){for(var t=e.split("\n"),n="",l=0;l<t.length;l++)if(t[l].startsWith("Query=")){for(n=t[l].split("=")[1],l++;!t[l].startsWith("Length=");)n=n+" "+t[l],l++;break}return n}(e)}function $(e,t,n,l,i,r,o){var p=document.createElement("select");p.style.width="430px",p.style.marginBottom="20px",p.style.color="#5C6D7E",p.style.float="right";for(var d=0;d<e.length;d++){var c=document.createElement("option");c.value=d,c.text=f(e[d]),d==n&&(c.selected="selected"),p.appendChild(c)}return p.onchange=function(){!function(e,t,n,l,i,r,o){var p=s(e[n]);if(l=a(e[n]),0==p.length){for(var d=["blast-alignments-table","blast-single-alignment"],c=0;c<d.length;c++)for(var h=document.getElementById(d[c]);h.firstChild;)h.removeChild(h.firstChild);v(e,[],n,l,!0,!0,o)}else b(e,t,n,p,l,i,r,o),x(p,o),t=p[0].hsp.length,C(p[0],o,t,0)}(e,t,p.value,l,i,r,o)},p}function v(e,t,n,l,i,r,a){for(var s=document.getElementById(a.opt.multipleAlignments);s.hasChildNodes();)s.removeChild(s.firstChild);var o=document.createElement("div"),p=document.createElement("div"),d=document.createElement("div");if(s.style.paddingTop="20px",o.id="alignments-container",o.style.border="thin solid #DDD",o.style.margin="0 auto",o.style.padding="10px",o.style.maxWidth="580px",o.style.backgroundColor="#FFF",d.innerHTML="***NO HITS FOUND***",d.style.fontWeight="bold",d.style.paddingTop="30px",d.style.paddingBottom="50px",d.style.textAlign="center",1<e.length){var c=$(e,t,n,l,i,r,a),h=document.createElement("div"),m=document.createElement("div");m.style.clear="both",h.innerHTML="RESULTS FOR:".bold(),h.style.marginBottom="5px",h.style.color="#5C6D7E",h.style.float="left",o.appendChild(h),o.appendChild(c),o.appendChild(m)}(o=u(o,i,r,l)).appendChild(d),s.style.minWidth="580px",o.appendChild(p),s.appendChild(o)}function b(e,t,n,l,i,r,a,s){for(var o=document.getElementById(s.opt.multipleAlignments);o.hasChildNodes();)o.removeChild(o.firstChild);var p=document.createElement("div"),d=document.createElement("div"),h=document.createElement("input"),m=function e(t,n,l,i,r,a,s,o){var p=document.createElement("button");if(p.id="changeColors",p.className="btn",p.style.marginRight="10px",p.style.marginTop="5px",1==a)var d=document.createTextNode("Change colours to grayscale");else d=document.createTextNode("Change colours to full colored");return p.appendChild(d),p.onclick=function(){!function(e,t,n,l,i,r,a,s,o){a=1!=a,r.removeChild(r.childNodes[0]);for(var p=document.getElementById(o.opt.multipleAlignments);p.firstChild;)p.removeChild(p.firstChild);b(e,t,n,l,i,a,s,o)}(t,n,l,i,r,p,a,s,o)},p}(e,t,n,l,i,r,a,s),f=function e(t,n,l,i,r,a,s,o){var p=document.createElement("button");if(p.id="changeScore",p.className="btn",p.style.marginRight="10px",p.style.marginTop="5px",1==s)var d=document.createTextNode("Change scoring to E value");else d=document.createTextNode("Change scoring to Max score");return p.appendChild(d),p.onclick=function(){!function(e,t,n,l,i,r,a,s,o){s=1!=s,r.removeChild(r.childNodes[0]);for(var p=document.getElementById(o.opt.multipleAlignments);p.firstChild;)p.removeChild(p.firstChild);b(e,t,n,l,i,a,s,o)}(t,n,l,i,r,p,a,s,o)},p}(e,t,n,l,i,r,a,s),v=g("PNG"),x=g("JPEG");if(o.style.paddingTop="20px",h.id="defline",h.name="defline",h.type="text",h.value=" Mouse over to show defline and scores, click to show alignments",h.style.width="556px",h.style.padding="1px",h.style.border=0,h.style.cursos="auto",p.id="alignments-container",p.style.border="thin solid #DDD",p.style.margin="0 auto",p.style.padding="10px",p.style.maxWidth="580px",p.style.backgroundColor="#FFF",1<e.length){var E=$(e,t,n,i,r,a,s),C=document.createElement("div"),_=document.createElement("div");_.style.clear="both",C.innerHTML="RESULTS FOR:".bold(),C.style.marginBottom="5px",C.style.color="#5C6D7E",C.style.float="left",p.appendChild(C),p.appendChild(E),p.appendChild(_)}(p=function(e,t,n,l,i){var r,a,s,o,p=document.createElement("div");p.style.paddingBottom="10px";for(var d=0;d<e.length;d++){var h=y((r=l,a=i,s=e[d].hsp[0].score,o=e[d].hsp[0].eValue,c(r,a?s<40?1:40<=s&&s<50?2:50<=s&&s<80?3:80<=s&&s<200?4:5:100<o?1:o<=100&&1<o?2:o<=1&&.01<o?3:o<=.01&&1e-5<o?4:5)),e[d],t);h.style.marginBottom="4px",p.appendChild(h)}return n.appendChild(p),n}(l,i,p=u(p,r,a,i),r,a)).appendChild(h),d.style.textAlign="right",d.id="blast-multiple-alignments-buttons",o.style.minWidth="580px",d.appendChild(f),d.appendChild(m),d.appendChild(document.createElement("br")),d.appendChild(v),d.appendChild(x),p.appendChild(d),o.appendChild(p)}function x(e,t){for(var n=document.getElementById(t.opt.alignmentsTable);n.hasChildNodes();)n.removeChild(n.firstChild);var l,i,r,a,s,o,p,d,c,h,m,u,y,g,f=document.createElement("div"),$=(l=e,i=document.createElement("div"),r=document.createElement("button"),a=document.createElement("button"),s=document.createElement("button"),i.style.textAlign="right",r.style.marginRight="10px",r.className="btn",r.innerHTML="Download as CSV",r.onclick=function(){!function(e){var t="data:text/csv;charset=utf-8,";t+="Description; Score; eValue; Identities; Positives; Gaps\n";for(var n=0;n<e.length;n++)t+=e[n].description,t+="; ",t+=e[n].hsp[0].score,t+="; ",t+=e[n].hsp[0].eValue,t+="; ",t+=e[n].hsp[0].identities,t+="; ",t+=e[n].hsp[0].positives,t+="; ",t+=e[n].hsp[0].gaps,t+="\n";var l=encodeURI(t),i=document.createElement("a");i.setAttribute("href",l),i.setAttribute("download","alignments-table.csv"),i.click()}(l)},s.className="btn",s.innerHTML="Download as PNG",s.onclick=function(){E("PNG")},s.style.marginRight="10px",a.className="btn",a.innerHTML="Download as JPEG",a.onclick=function(){E("JPEG")},i.appendChild(r),i.appendChild(s),i.appendChild(a),i),v=(o=document.createElement("table"),p=document.createElement("thead"),d=document.createElement("tr"),c=document.createElement("th"),h=document.createElement("th"),m=document.createElement("th"),u=document.createElement("th"),y=document.createElement("th"),g=document.createElement("th"),subjectStartTh=document.createElement("th"),subjectEndTh=document.createElement("th"),lengthTh=document.createElement("th"),o.className="table table-striped",(tableContainer=document.createElement("div")).style.overflowX="auto",tableContainer.style.width="100%",c.style.minWidth="300px",u.style.minWidth="100px",g.style.minWidth="100px",y.style.minWidth="100px",subjectStartTh.style.minWidth="100px",subjectEndTh.style.minWidth="100px",o.style.width="auto",c.innerHTML="Description".bold(),h.innerHTML="Max score".bold(),m.innerHTML="Total score".bold(),u.innerHTML="Query cover".bold(),y.innerHTML="E value".bold(),g.innerHTML="Identities".bold(),subjectStartTh.innerHTML="Subject Start".bold(),subjectEndTh.innerHTML="Subject End".bold(),lengthTh.innerHTML="Length".bold(),d.appendChild(c),d.appendChild(h),d.appendChild(m),d.appendChild(u),d.appendChild(y),d.appendChild(g),d.appendChild(subjectStartTh),d.appendChild(subjectEndTh),d.appendChild(lengthTh),p.appendChild(d),o.appendChild(p),o),b=document.createElement("tbody");n.style.paddingTop="50px",n.style.margin="0 auto",n.style.display="table",f.style.backgroundColor="#FFF",f.style.margin="0 auto",f.style.maxWidth="580px",f.id="blast-alignments-table-img";for(var x=0;x<e.length;x++){var _=document.createElement("tr"),w=document.createElement("td"),T=document.createElement("button");T.alignment=e[x],T.onclick=function(){var e=this.alignment.description.split(" ")[1];fetch(`/api/accession/${e}`).then(e=>e.json()).then(e=>{if(e.error)throw Error(e.error);showModal(componentToHtml(e.title),componentToHtml(e.content))}).catch(t=>{console.error("Error fetching accession details:",t),showModal("Error",`<div style="color: red; padding: 20px;">
                                                        <p>Error loading details for ${e}.</p>
                                                        <p>This is a known issue with the integration of modals for SBS accessions. I'm working on it :)</p>
                                                        <p>Details: ${t.message}</p>
                                                    </div>`)}),t.opt.singleAlignment&&document.getElementById(t.opt.singleAlignment)&&(location.href="#"+t.opt.singleAlignment,C(this.alignment,t,this.alignment.hsp.length,0)),t.opt.callback&&t.opt.callback(this.alignment)},T.id=e[x].description.split(" ")[0],T.innerHTML=e[x].description.split(" ")[1],T.className="alignment-table-description",T.style.cssText=`
                                        color: #228BE6 !important;
                                        cursor: pointer;
                                        text-decoration: underline;
                                        font-weight: 500;
                                        background: none;
                                        border: none;
                                        padding: 0;
                                    `,T.style.border=0,T.style.padding=0,T.style.display="inline",T.style.background="none",T.style.maxWidth="300px",T.style.overflow="hidden",T.style.textOverflow="ellipsis",T.style.whiteSpace="nowrap",w.appendChild(T);var H=document.createElement("td");H.innerHTML=e[x].hsp[0].score;var L=document.createElement("td");L.innerHTML=e[x].totalScore;var F=document.createElement("td");F.innerHTML=e[x].queryCover+"%";var A=document.createElement("td");A.innerHTML=e[x].hsp[0].eValue;var M=document.createElement("td");M.innerHTML=e[x].hsp[0].identities+"%";var B=document.createElement("td");B.innerHTML=e[x].hsp[0].subjectStart;var k=document.createElement("td");k.innerHTML=e[x].hsp[0].subjectEnd;var W=document.createElement("td");W.innerHTML=e[x].length,w.style.maxWidth="300px",w.style.overflow="hidden",w.style.textOverflow="ellipsis",w.style.whiteSpace="nowrap",T.style.maxWidth="300px",T.style.overflow="hidden",T.style.textOverflow="ellipsis",T.style.whiteSpace="nowrap",_.appendChild(w),_.appendChild(H),_.appendChild(L),_.appendChild(F),_.appendChild(A),_.appendChild(M),_.appendChild(B),_.appendChild(k),_.appendChild(W),b.appendChild(_)}v.appendChild(b),f.appendChild(v),n.appendChild(f),n.appendChild($)}function E(e){var t,n=document.getElementsByClassName("alignment-table-description");for(t=0;t<n.length;t++)n[t].style.fontWeight="normal",n[t].parentElement.parentElement.style.fontWeight="normal";html2canvas(document.getElementById("blast-alignments-table-img"),{onrendered:function(t){document.body.appendChild(t);var n=document.createElement("a");document.body.appendChild(n),n.href="JPEG"==e?t.toDataURL("image/jpeg"):t.toDataURL("img/png"),n.download="alignments-table."+e.toLowerCase(),n.click(),document.body.removeChild(t),document.body.removeChild(n),n=document.createElement("a"),document.body.appendChild(n),n.href="#blast-alignments-table",n.click(),document.body.removeChild(n)}})}function C(e,t,n,l){for(var i=document.getElementById(t.opt.singleAlignment);i.hasChildNodes();)i.removeChild(i.firstChild);var r=document.createElement("pre"),a=document.createElement("div"),s=document.createElement("button"),o=document.createElement("button"),p=document.createElement("span"),d=document.createElement("div"),c=document.createElement("div"),h=document.createElement("div"),m=document.createElement("div"),u=document.createElement("div"),y=document.createElement("div"),g=document.createElement("div"),f=function(e,t,n){var l=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div"),a=document.createElement("div");l.innerHTML="Query".bold(),l.style.display="inline-block",l.style.marginRight="20px",l.style.textAlign="right",l.style.width="55px",i.innerHTML=String(t).bold(),i.style.display="inline-block",i.style.marginRight="20px",i.style.width="25px",r.innerHTML=String(n).bold(),r.style.display="inline-block",r.style.marginLeft="20px",r.style.marginRight="70px",a.appendChild(l),a.appendChild(i);for(var s=0;s<e.length;s++){var o=document.createElement("div");o.style.backgroundColor=w(e.charAt(s)),o.innerHTML=e.charAt(s).bold(),o.style.width="18px",o.style.textAlign="center",o.style.display="inline-block",a.appendChild(o)}return a.appendChild(r),a}(e.hsp[l].query,e.hsp[l].queryStart,e.hsp[l].queryEnd),$=function(e){var t=document.createElement("div"),n=document.createElement("div");n.style.minWidth="120px",n.style.minHeight="1px",n.style.display="inline-block",t.appendChild(n);for(var l=0;l<e.length;l++){var i=document.createElement("div");i.style.backgroundColor=w(e.charAt(l)),i.innerHTML=e.charAt(l).bold(),i.style.width="18px",i.style.textAlign="center",i.style.display="inline-block",t.appendChild(i)}return t}(e.hsp[l].comparison),v=function(e,t,n){var l=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div"),a=document.createElement("div");l.innerHTML="Subject".bold(),l.style.display="inline-block",l.style.textAlign="right",l.style.marginRight="20px",l.style.width="55px",i.style.width="25px",i.innerHTML=String(t).bold(),i.style.display="inline-block",i.style.marginRight="20px",r.innerHTML=String(n).bold(),r.style.display="inline-block",r.style.marginLeft="20px",r.style.marginRight="70px",a.appendChild(l),a.appendChild(i);for(var s=0;s<e.length;s++){var o=document.createElement("div");o.style.backgroundColor=w(e.charAt(s)),o.innerHTML=e.charAt(s).bold(),o.style.width="18px",o.style.textAlign="center",o.style.display="inline-block",a.appendChild(o)}return a.appendChild(r),a}(e.hsp[l].subject,e.hsp[l].subjectStart,e.hsp[l].subjectEnd);if(r.style.color="#2c3e50",r.style.paddingTop="25px",r.style.paddingBottom="40px",r.style.textAlign="left",r.style.fontFamily="Helvetica,Arial,sans-serif",r.id="blast-single-alignment-pre",a.style.margin="0 auto",a.style.display="table",a.style.paddingTop="30px",i.style.textAlign="right",i.style.paddingTop="50px",o.className="btn",o.innerHTML="Download as PNG",o.style.marginRight="10px",o.onclick=function(){_(e,"PNG")},s.className="btn",s.innerHTML="Download as JPEG",s.onclick=function(){_(e,"JPEG")},p.innerHTML=e.description,p.style.paddingLeft="15px",p.style.fontWeight="bold",p.style.fontSize="15px",p.style.fontFamily="Helvetica,Arial,sans-serif",d.style.paddingTop="20px",d.style.fontSize="14px",d.style.textAlign="center",d.style.fontFamily="Helvetica,Arial,sans-serif",d.style.display="table",d.style.margin="0px auto",d.style.width="100%",c.innerHTML="<b>Score:</b></br>"+e.hsp[l].score,c.style.float="left",c.style.width="20%",h.innerHTML="<b>Expect:</b></br>"+e.hsp[l].eValue,h.style.float="left",h.style.width="20%",m.innerHTML="<b>Identities:</b></br>"+e.hsp[l].identities+"%",m.style.float="left",m.style.width="20%",u.innerHTML="<b>Positives:</b></br>"+e.hsp[l].positives+"%",u.style.float="left",u.style.width="20%",y.innerHTML="<b>Gaps:</b></br>"+e.hsp[l].gaps+"%",y.style.float="left",y.style.width="20%",g.style.clear="both",d.appendChild(c),d.appendChild(h),d.appendChild(m),d.appendChild(u),d.appendChild(y),d.appendChild(g),a.appendChild(f),a.appendChild($),a.appendChild(v),r.appendChild(p),r.appendChild(d),r.appendChild(a),i.appendChild(r),1<n){var b=document.createElement("button");if(b.className="btn",b.id="blast-single-alignment-next",b.innerHTML="Next HSP",b.style.marginTop="5px",b.style.marginRight="15px",b.style.float="right",l==n-1)var x=0;else x=l+1;b.onclick=function(){C(e,t,n,x)},r.appendChild(b)}i.appendChild(o),i.appendChild(s)}function _(e,t){var n=document.getElementById("blast-single-alignment-pre"),l=document.getElementById("blast-single-alignment-next");void 0!==l&&null!=l&&n.removeChild(l),html2canvas(n,{onrendered:function(i){document.body.appendChild(i);var r=document.createElement("a");document.body.appendChild(r),r.href="JPEG"==t?i.toDataURL("image/jpeg"):i.toDataURL("img/png"),r.download=e.description+"-alignment."+t.toLowerCase(),r.click(),document.body.removeChild(i),document.body.removeChild(r),void 0!==l&&null!=l&&n.appendChild(l),r=document.createElement("a"),document.body.appendChild(r),r.href="#blast-single-alignment",r.click(),document.body.removeChild(r)}})}function w(e){switch(e){case"A":return"#DBFA60";case"C":return"#F9FA60";case"D":return"#F9605F";case"E":return"#F9609C";case"F":return"#5FF99D";case"G":return"#F9BC5F";case"H":return"#609DF9";case"I":return"#99F95A";case"K":return"#A062FF";case"L":return"#7EF960";case"M":return"#63FF63";case"N":return"#D95DF9";case"P":return"#F9DA60";case"Q":return"#F955D8";case"R":return"#5360FB";case"S":return"#F97E60";case"T":return"#FFA563";case"V":return"#C0F86B";case"W":return"#FDD9F9";case"Y":return"#60F9DA";default:return"#FFFFFF"}}String.prototype.startsWith=function(e){return 0===this.indexOf(e)}}})},{"js-class":1,"js-extend":2},]},{},[]);var modalHtml=`
    <div id="blast-js-modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4);">
        <div style="
            background-color: white;
            margin: 0;
            padding: 20px;
            border-radius: 4px;
            width: 100%;
            height: 100%;
            max-height: 100vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05) 0px 20px 25px -5px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        ">
            <div style="
                position: sticky;
                top: 0;
                background: white;
                padding: 0 0 15px 0;
                margin: -20px -20px 20px -20px;
                padding: 20px;
                z-index: 1;
                border-bottom: 1px solid #dee2e6;
            ">
                <span id="blast-js-modal-close" style="
                    color: #868e96;
                    float: right;
                    font-size: 22px;
                    font-weight: normal;
                    cursor: pointer;
                    transition: color 0.15s ease;
                    padding: 10px;
                    margin: -10px;
                ">&times;</span>
                <h2 id="blast-js-modal-title" style="
                    margin: 0;
                    color: #212529;
                    font-size: clamp(18px, 4vw, 24px);
                    font-weight: 600;
                    line-height: 1.3;
                    padding-right: 20px;
                "></h2>
            </div>
            <div id="blast-modal-content" style="
                padding: 0 10px;
                color: #212529;
                line-height: 1.5;
            "></div>
            <div id="blast-modal-data"></div>
        </div>
    </div>
`;function componentToHtml(e){if(!e)return"";if("string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>componentToHtml(e)).join("");if(e.type){let t;switch(e.type){case"Paper":(t=document.createElement("div")).style.padding="clamp(12px, 3vw, 16px)",t.style.backgroundColor="white",t.style.border="1px solid #dee2e6",t.style.borderRadius="4px",t.style.marginBottom="16px",t.style.overflowX="auto";break;case"Title":(t=document.createElement("h2")).style.fontSize=e.props?.order===4?"clamp(14px, 3vw, 16px)":"clamp(18px, 4vw, 24px)",t.style.fontWeight="600",t.style.color="#212529",t.style.marginBottom="10px",t.style.lineHeight="1.3";break;case"SimpleGrid":(t=document.createElement("div")).style.display="grid",t.style.gridTemplateColumns="repeat(auto-fit, minmax(min(100%, 350px), 1fr))",t.style.gap="clamp(8px, 2vw, 16px)";let n=document.createElement("style");n.textContent=`
                    @media (max-width: 768px) {
                        #${t.id} {
                            grid-template-columns: 1fr !important;
                        }
                    }
                `,document.head.appendChild(n),t.id="grid-"+Math.random().toString(36).substr(2,9);break;case"Group":(t=document.createElement("div")).style.display="flex",t.style.alignItems="center",t.style.gap="8px",t.style.flexWrap="wrap",t.style.fontSize="clamp(13px, 2vw, 14px)",t.style.width="100%";let l=document.createElement("style");l.textContent=`
                    @media (max-width: 768px) {
                        #${t.id} {
                            flex-direction: column;
                            align-items: flex-start;
                            gap: 4px;
                        }
                        #${t.id} > * {
                            width: 100%;
                        }
                    }
                `,document.head.appendChild(l),t.id="group-"+Math.random().toString(36).substr(2,9);break;case"Text":t=document.createElement("span"),e.props?.fw===700&&(t.style.fontWeight="600",t.style.color="#212529"),t.style.fontSize="clamp(13px, 2vw, 14px)";let i=document.createElement("style");i.textContent=`
                    @media (max-width: 768px) {
                        #${t.id} {
                            display: block;
                            width: 100%;
                        }
                    }
                `,document.head.appendChild(i),t.id="text-"+Math.random().toString(36).substr(2,9);break;case"Badge":(t=document.createElement("span")).style.padding="2px 8px",t.style.borderRadius="4px",t.style.fontSize="clamp(11px, 2vw, 12px)",t.style.fontWeight="500",t.style.whiteSpace="nowrap",t.style.backgroundColor=e.props?.color==="green"?"#e9faf0":e.props?.color==="yellow"?"#fff8e1":e.props?.color==="blue"?"#e7f5ff":"#f1f3f5",t.style.color=e.props?.color==="green"?"#099268":e.props?.color==="yellow"?"#f59f00":e.props?.color==="blue"?"#1c7ed6":"#495057";break;default:(t=document.createElement("div")).style.fontSize="clamp(13px, 2vw, 14px)"}return e.style&&Object.assign(t.style,e.style),e.className&&(t.className=e.className),e.children&&(t.innerHTML=componentToHtml(e.children)),t.outerHTML}return String(e)}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("blast-js-modal-close");e&&(e.addEventListener("mouseover",function(){this.style.color="#000"}),e.addEventListener("mouseout",function(){this.style.color="#666"}))});